<div id="widget-chat">


    <input type="text" class="form-control" placeholder="Escribir mensaje"
           id="escribir-mensaje"/>
    <button onclick="insertarMensaje()" class="btn btn-primary">Enviar</button>

    <div id="panel-mensajes">

    </div>

</div>

<script>

    /**
     * Mostrar mensajes
     */
    $.ajax({
        url: URLbase +"/mensaje?usuarioFrom=" + loggedUserEmail + "&usuarioTo=" + chattingWithEmail,
        type: "GET",
        data: {},
        dataType: 'json',
        headers: {
            "token": token
        },
        success: function (mensajes) {
            for (i = 0; i < mensajes.length; i++) {
                if (loggedUserEmail == mensajes[i].usuarioFrom)
                    $("#panel-mensajes").append(
                        "<h5 id=" + mensajes[i]._id + " align=\"right\" class='alert alert-success'>" + mensajes[i].contenido + "</h5>");
                else
                    $("#panel-mensajes").append(
                        "<h5 id=" + mensajes[i]._id + " align=\"left\" class='alert alert-success'>" + mensajes[i].contenido + "</h5>");
            }
        },
        error: function (error) {
            console.log(error);
        }
    });

    /**
     * Insertar mensaje
     */
    function insertarMensaje() {

        var mensaje = {
            usuarioTo: chattingWithEmail,
            contenido: $("#escribir-mensaje").val(),
        };
        $.ajax({
            url: URLbase + "/mensaje",
            type: "POST",
            data: mensaje,
            dataType: 'json',
            headers: {"token": token},
            success: function (response) {
                console.log("Mensaje enviado");
                $("#escribir-mensaje").val("");
            },
            error: function (error) {
                console.log(error);
            }
        });
    }

</script>